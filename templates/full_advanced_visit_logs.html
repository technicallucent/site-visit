<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Advanced Visit Logs</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>
    <div class="container mt-5">
        <h2 class="mb-4">Advanced Visit Logs Filter</h2>

        <form method="POST" class="mb-4">
            <div class="row g-3">

                <!-- Client Info -->
                <div class="col-md-3">
                    <label class="form-label">Client Name</label>
                    <input type="text" name="client_name" class="form-control" value="{{ filters.client_name }}">
                </div>

                <div class="col-md-3">
                    <label class="form-label">Mobile</label>
                    <input type="text" name="client_mobile" class="form-control" value="{{ filters.client_mobile }}">
                </div>

                <div class="col-md-3">
                    <label class="form-label">Email</label>
                    <input type="text" name="client_email" class="form-control" value="{{ filters.client_email }}">
                </div>

                <div class="col-md-3">
                    <label class="form-label">Site Visit Project</label>
                    <select name="project" class="form-select">
                        <option value="">-- All --</option>
                        {% for p in projects %}
                        <option value="{{ p.id }}" {% if filters.project==p.id|string %}selected{% endif %}>{{ p.name }}
                        </option>
                        {% endfor %}
                    </select>
                </div>

                <!-- Preferred Location -->
                <div class="col-md-3">
                    <label class="form-label">Preferred Location</label>
                    <select name="preferred_location" class="form-select">
                        <option value="">-- All --</option>
                        {% for loc in locations %}
                        <option value="{{ loc }}" {% if filters.preferred_location==loc %}selected{% endif %}>{{ loc }}
                        </option>
                        {% endfor %}
                    </select>
                </div>


                <!-- Lead Source -->
                <div class="col-md-3">
                    <label class="form-label">Lead Source</label>
                    <select name="lead_source" class="form-select">
                        <option value="">-- All --</option>
                        {% for ls in lead_sources %}
                        <option value="{{ ls }}" {% if filters.lead_source==ls %}selected{% endif %}>{{ ls }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="col-md-3">
                    <label class="form-label">Lead Source Project</label>
                    <select name="lead_source_project" class="form-select">
                        <option value="">Select Project</option>
                        {% for p in projects %}
                        <option value="{{ p.name }}" {% if filters.lead_source_project==p.name|string %}selected{% endif
                            %}>{{ p.name }}</option>
                        {% endfor %}
                    </select>
                </div>

                <!-- BHK and Budget -->
                <div class="col-md-3">
                    <label class="form-label">BHK Requirement</label>
                    <select name="bhk_requirement" class="form-select">
                        <option value="">-- All --</option>
                        {% for b in bhk_options %}
                        <option value="{{ b }}" {% if filters.bhk_requirement==b %}selected{% endif %}>{{ b }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="col-md-3">
                    <label class="form-label">Budget</label>
                    <select name="budget" class="form-select">
                        <option value="">-- All --</option>
                        {% for b in budgets %}
                        <option value="{{ b }}" {% if filters.budget==b %}selected{% endif %}>{{ b }}</option>
                        {% endfor %}
                    </select>
                </div>

                <!-- Current Location -->
                <div class="col-md-3">
                    <label class="form-label">Current Location</label>
                    <select name="current_location" class="form-select">
                        <option value="">-- All --</option>
                        {% for l in current_locations %}
                        <option value="{{ l }}" {% if filters.current_location==l %}selected{% endif %}>{{ l }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="col-md-3">
                    <label class="form-label">Client Building Name</label>
                    <input type="text" name="building_name" class="form-control" value="{{ filters.building_name }}">
                </div>

                <!-- Preferred Projects -->
                <div class="col-md-3">
                    <label class="form-label">Preferred Projects</label>
                    <select name="preferred_projects" class="form-select">
                        <option value="">Select Project</option>
                        {% for p in projects %}
                        <option value="{{ p.id }}" {% if filters.preferred_projects==p.id|string %}selected{% endif %}>
                            {{ p.name }}</option>
                        {% endfor %}
                    </select>
                </div>

                <!-- Ethnicity & Profession -->
                <div class="col-md-3">
                    <label class="form-label">Ethnicity</label>
                    <select name="ethnicity" class="form-select">
                        <option value="">-- All --</option>
                        {% for e in ethnicities %}
                        <option value="{{ e }}" {% if filters.ethnicity==e %}selected{% endif %}>{{ e }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="col-md-3">
                    <label class="form-label">Profession</label>
                    <select name="profession" class="form-select">
                        <option value="">-- All --</option>
                        {% for p in professions %}
                        <option value="{{ p }}" {% if filters.profession==p %}selected{% endif %}>{{ p }}</option>
                        {% endfor %}
                    </select>
                </div>

                <!-- Agent -->
                <div class="col-md-3">
                    <label class="form-label">Agent</label>
                    <select name="agent" class="form-select">
                        <option value="">-- All --</option>
                        {% for a in agents %}
                        <option value="{{ a.id }}" {% if filters.agent==a.id|string %}selected{% endif %}>{{ a.name }}
                        </option>
                        {% endfor %}
                    </select>
                </div>

                <!-- Status -->
                <div class="col-md-3">
                    <label class="form-label">Status</label>
                    <select name="status" class="form-select">
                        <option value="">-- All --</option>
                        {% for s in statuses %}
                        <option value="{{ s }}" {% if filters.status==s %}selected{% endif %}>{{ s }}</option>
                        {% endfor %}
                    </select>
                </div>

                <!-- Date Range -->
                <div class="col-md-3">
                    <label class="form-label">Start Date</label>
                    <input type="date" name="start_date" class="form-control" value="{{ filters.start_date }}">
                </div>

                <div class="col-md-3">
                    <label class="form-label">End Date</label>
                    <input type="date" name="end_date" class="form-control" value="{{ filters.end_date }}">
                </div>

            </div>

            <div class="mt-4">
                <button type="submit" class="btn btn-primary">Filter</button>
                <a href="{{ url_for('full_filter_visit_logs') }}" class="btn btn-secondary">Reset</a>
            </div>
        </form>

        <!-- Results Table -->
        <div class="table-responsive mt-4">
            <table class="table table-bordered table-striped">
                <thead class="table-light">
                    <tr>
                        <th>ID</th>
                        <th>Agent</th>
                        <th>Client Name</th>
                        <th>Mobile</th>
                        <th>Email</th>
                        <th>Lead Source</th>
                        <th>Lead Source Project</th>
                        <th>BHK</th>
                        <th>Budget</th>
                        <th>Preferred Location</th>
                        <th>Current Location</th>
                        <th>Building</th>
                        <th>Preferred Projects</th>
                        <th>Ethnicity</th>
                        <th>Profession</th>
                        <th>Client Notes</th>
                        <th>Project</th>
                        <th>Visit Date</th>
                        <th>Status</th>
                       
                        <th>Visit Notes</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for v in visits %}
                    <tr>
                        <td>{{ v.id }}</td>
                        <td>{{ v.agent }}</td>
                        <td>{{ v.client_name }}</td>
                        <td>{{ v.client_mobile }}</td>
                        <td>{{ v.client_email }}</td>
                        <td>{{ v.lead_source }}</td>
                        <td>{{ v.lead_source_project }}</td>
                        <td>{{ v.bhk_requirement }}</td>
                        <td>{{ v.budget }}</td>
                        <td>{{ v.preferred_location }}</td>
                        <td>{{ v.current_location }}</td>
                        <td>{{ v.building_name }}</td>
                        <td>{{ v.preferred_projects }}</td>
                        <td>{{ v.ethnicity }}</td>
                        <td>{{ v.profession }}</td>
                        <td>{{ v.client_notes or '-' }}</td>
                        <td>{{ v.project_name }}</td>
                        <td>{{ v.visit_date }}</td>
                        <td>{{ v.status }}</td>
          
                        <td>{{ v.visit_notes or '-' }}</td>
                        <td>
                            {% if v.can_delete %}
                            <a href="#" class="btn btn-danger btn-sm">Delete</a>
                            {% endif %}
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="22" class="text-center text-muted">No records found</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>